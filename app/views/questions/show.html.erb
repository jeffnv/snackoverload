<!-- title
question body
  comments

# answers
answer
  comments -->

<div class="question">
  <div class="page-header">
    <h1><%=@question.title%></h1>
  </div>
  <p class="lead"><%=@question.body%></p>
  
  <%=render 'shared/tags', tags: @question.tags%>
  
  <p>Asked by: <%=render 'shared/user', user: @question.asker%></p>
  
  <%=render 'shared/comments', commentable: @question%>
</div><!-- question -->
<hr>
<h2><%=@question.answers.count%> answers</h2>

<ul>
  <%@question.answers.each do |answer|%>
  <li>
    <div class="answer">
      <p class="lead"><%=answer.body%></p>
      <p>
        answered by: <%=render 'shared/user', user: answer.answerer%>
      </p>
      <%=render 'shared/comments', commentable: answer%>
    </div>
  </li>
  <%end%>
</ul>

<hr>
<h2>Have the Answer?</h2>
<%if user_signed_in?%>
<%=render 'shared/answer_form', question: @question%>
<%else%>
<h3><a href="<%=new_user_session_url%>">log in, and post it!</a></h3>
<%end%>

<%if current_user%>
<script>
  $('.comment-form').on('submit', function(event){
    event.preventDefault();
    $.ajax({
      type: "POST",
      url: "<%=comments_url%>",
      data: $(event.target).serializeJSON(),
      success: function(comment){
        var selectorString = '[data-commentable="' + 
                              comment.commentable_type +
                              '_' +
                              comment.commentable_id + 
                              '"]';
                              
        var $commentList = $(selectorString);
          var newCommentStr = '<li>' + 
                               comment.body +  
                               ' - ' + 
                               '<a href="<%=user_url(current_user)%>">' + 
                               '<%=current_user.email%></a>' + 
                               '</li>';
          $commentList.append(newCommentStr)
        

      }
    })
  })
</script
<%end%>